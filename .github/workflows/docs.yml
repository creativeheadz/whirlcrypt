name: üìö Deploy API Documentation

on:
  push:
    branches: [ main ]
    paths: 
      - 'docs/**'
      - 'README.md'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    
    steps:
      - name: üõí Checkout
        uses: actions/checkout@v4

      - name: üìù Setup Pages
        uses: actions/configure-pages@v4

      - name: üî® Build Documentation Site
        run: |
          mkdir -p _site
          
          # Copy main documentation files
          cp -r docs/* _site/ 2>/dev/null || true
          cp README.md _site/ 2>/dev/null || true
          
          # Ensure assets directory exists and copy updated logo
          mkdir -p _site/assets
          cp frontend/public/assets/logo.png _site/assets/logo.png 2>/dev/null || cp whirlcrypt-high-resolution-logo-transparent.png _site/assets/logo.png
          
          # Create beautiful index.html
          cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Whirlcrypt API Documentation</title>
            <style>
              body { 
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                max-width: 1200px; margin: 0 auto; padding: 2rem;
                background: linear-gradient(135deg, #f9fafb 0%, #ffffff 50%, #f3f4f6 100%);
                min-height: 100vh; color: #111827;
              }
              .container { 
                background: rgba(255, 255, 255, 0.6); 
                border-radius: 24px; padding: 3rem; 
                backdrop-filter: blur(20px);
                border: 1px solid rgba(0, 0, 0, 0.1);
                box-shadow: 0 20px 80px rgba(0, 0, 0, 0.1);
              }
              .logo { 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                margin-bottom: 2rem; 
              }
              .links { 
                display: grid; 
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
                gap: 1.5rem; margin-top: 3rem; 
              }
              .link-card { 
                background: rgba(255, 122, 0, 0.1); 
                padding: 2rem; 
                border-radius: 16px;
                border: 1px solid rgba(255, 122, 0, 0.2); 
                text-decoration: none; 
                color: #111827;
                transition: all 0.3s ease;
                display: block;
                backdrop-filter: blur(10px);
              }
              .link-card:hover { 
                transform: translateY(-8px); 
                background: rgba(255, 122, 0, 0.2); 
                border-color: rgba(255, 122, 0, 0.4);
                box-shadow: 0 15px 40px rgba(255, 122, 0, 0.2);
              }
              .link-title { 
                font-size: 1.4rem; 
                font-weight: bold; 
                margin-bottom: 0.75rem; 
                color: #ff9500;
              }
              .link-desc { 
                opacity: 0.8; 
                font-size: 1rem; 
                line-height: 1.5;
                color: #374151;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <div class="logo">
                <img src="./assets/logo.png" alt="Whirlcrypt Logo" style="height: 120px; width: auto;" />
              </div>
              <p style="text-align: center; opacity: 0.8; margin-bottom: 2rem; font-size: 1.1rem; color: #4b5563;">
                Secure file sharing with RFC 8188 encryption
              </p>
              
              <div class="links">
                <a href="./api.html" class="link-card">
                  <div class="link-title">üìñ Complete API Reference</div>
                  <div class="link-desc">Detailed documentation with examples and code samples</div>
                </a>
                
                <a href="./openapi.yaml" class="link-card">
                  <div class="link-title">‚öôÔ∏è OpenAPI Specification</div>
                  <div class="link-desc">YAML specification for API integration</div>
                </a>
                
                <a href="https://editor.swagger.io/?url=https://creativeheadz.github.io/whirlcrypt/openapi.yaml" class="link-card" target="_blank">
                  <div class="link-title">üöÄ Interactive API Explorer</div>
                  <div class="link-desc">Try the API endpoints with Swagger Editor</div>
                </a>
                
                <a href="https://github.com/creativeheadz/whirlcrypt" class="link-card" target="_blank">
                  <div class="link-title">üìÇ Source Code</div>
                  <div class="link-desc">View the complete source code on GitHub</div>
                </a>
              </div>
              
              <div style="text-align: center; margin-top: 3rem; opacity: 0.7; font-size: 0.95rem; color: #6b7280;">
                Built with ‚ù§Ô∏è using RFC 8188 encryption standards
              </div>
            </div>
          </body>
          </html>
          EOF
          
      - name: üì§ Upload artifact
        uses: actions/upload-pages-artifact@v3

      - name: üöÄ Deploy to GitHub Pages  
        id: deployment
        uses: actions/deploy-pages@v4